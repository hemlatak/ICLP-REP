
All members who have accrual/earning TRNX (NCB) after 7th Aug 2010
-----------------------------------------------------------------------------------------
select account_number,customer_id into tmpp_1 from NCB_CMS_CUSTOMER_NCB_POINTS
where account_number in
(select account_number from TMP_CANCELLED_MEMBERS_REPORT_1)
and activity_date > '2010-08-07'
group by account_number,customer_id

---2709 rows

select * from tmpp_1;

-----2709 rows

select a.*,b.CARD_TYPE into tmpp_2 from tmpp_1 a,NCB_CMS_CUSTOMER_CARD_TYPE b
where a.account_number=b.account_number
and a.customer_id=b.customer_id


---2819 rows

select * from tmpp_2;

--2819 rows

select a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
from tmpp_2 a,NCB_CMS_CODE b
where a.card_type = b.CODE_ID
group by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
order by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc;

--2819 rows

select a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc into tmpp_3
from tmpp_2 a,NCB_CMS_CODE b
where a.card_type = b.CODE_ID
group by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
order by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc;

--2819 rows

select * from tmpp_3;

select account_number,customer_id,count(*)
from tmpp_3
group by account_number,customer_id
having count(*)>1

--108 rows

select account_number,count(*)
from tmpp_3
group by account_number
having count(*)>1

--110 rows
sum of count is 222

select * from tmpp_3 where account_number in 
(select account_number  from tmpp_3 group by account_number 
having count(*) > 1 ) 

--222 rows







select a.account_number,a.customer_id,b.CARD_TYPE  into temp_1 from NCB_CMS_CUSTOMER_NCB_POINTS a
inner join NCB_CMS_CUSTOMER_CARD_TYPE b
on a.account_number=b.account_number
and a.customer_id=b.customer_id
where a.account_number in
(select account_number from TMP_CANCELLED_MEMBERS_REPORT_1)
and activity_date > '2010-08-07'
group by a.account_number,a.customer_id,b.CARD_TYPE;



select a.account_number,a.customer_id,b.CARD_TYPE   from NCB_CMS_CUSTOMER_NCB_POINTS a
inner join NCB_CMS_CUSTOMER_CARD_TYPE b
on a.account_number=b.account_number
and a.customer_id=b.customer_id
where a.account_number in
(select account_number from TMP_CANCELLED_MEMBERS_REPORT_1)
and activity_date > '2010-08-07'
group by a.account_number,a.customer_id,b.CARD_TYPE;

--2819 rows

select a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc 
from temp_1 a,NCB_CMS_CODE b
where a.card_type = b.CODE_ID
group by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
order by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc;

--2819 rows

--------------------

other category



select a.account_number,a.customer_id,b.CARD_TYPE into temp_2  from NCB_CMS_CUSTOMER_NCB_POINTS a
inner join NCB_CMS_CUSTOMER_CARD_TYPE b
on a.account_number=b.account_number
and a.customer_id=b.customer_id
where a.account_number in
(select account_number from TMP_CANCELLED_MEMBERS_REPORT_1)
and activity_date <= '2010-08-07'
group by a.account_number,a.customer_id,b.CARD_TYPE;

--6404 rows

select a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc 
from temp_2 a,NCB_CMS_CODE b
where a.card_type = b.CODE_ID
group by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
order by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc;

--6404 rows

select a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc into temp_3
from temp_2 a,NCB_CMS_CODE b
where a.card_type = b.CODE_ID
group by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
order by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc;

select * from temp_3

--6402 rows

select account_number,count(*)
from temp_3
group by account_number
having count(*)>1

--192 rows
sum of count is 387

select * from temp_3 where account_number in 
(select account_number  from temp_3 group by account_number 
having count(*) > 1 ) 

--383 rows
                                   

-----------------------------------------
                                   


select a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc 
from temp_1 a,NCB_CMS_CODE b
where a.card_type = b.CODE_ID
group by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc
order by a.account_number,a.customer_id,a.CARD_TYPE ,b.CODE_ID,b.code_desc;

--2819 rows